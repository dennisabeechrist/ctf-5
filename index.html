<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Session Fixer Challenge</title>
<style>
  body { background:#0f0f0f; color:#00ff99; font-family:monospace; text-align:center; padding-top:80px; }
  .box { background:#1a1a1a; border:2px solid #00ff99; display:inline-block; padding:30px; border-radius:10px; }
  input { margin:10px; padding:5px; width:200px; background:#0f0f0f; border:1px solid #00ff99; color:#00ff99; }
  button { padding:5px 15px; background:#00ff99; color:black; border:none; cursor:pointer; }
  #flag { margin-top:20px; color:#ff3333; font-weight:bold; display:none; }
</style>
</head>
<body>

<div class="box">
  <h1>üîê Session Fixer</h1>
  <p>Login as admin or modify your session cookie to match the admin session.</p>
  <input type="text" id="username" placeholder="Username"><br>
  <input type="password" id="password" placeholder="Password"><br>
  <button onclick="login()">Login</button>
  <div id="status"></div>
  <div id="flag"></div>
</div>

<script>
// --- Encode flag as array of char codes XORed with a secret key
const encodedFlag = [30,7,14,29,0,12,11,27,14,29,7,30]; // XORed char codes
const key = 42; // secret number

function decodeFlag() {
    let flag = '';
    for(let i=0;i<encodedFlag.length;i++){
        flag += String.fromCharCode(encodedFlag[i]^key);
    }
    return flag;
}

function getAdminSession() {
    // Last 4 digits of timestamp in seconds
    const ts = Math.floor(Date.now()/1000);
    return ts.toString().slice(-4);
}

function login() {
    const status = document.getElementById("status");
    const flagDiv = document.getElementById("flag");

    // Check cookie
    const cookies = document.cookie.split(";").map(c => c.trim());
    const sessionCookie = cookies.find(c => c.startsWith("session="));
    if(sessionCookie) {
        const val = sessionCookie.split("=")[1];
        if(val === getAdminSession()) {
            status.textContent = "Cookie valid! Here is the flag:";
            flagDiv.textContent = decodeFlag();
            flagDiv.style.display = "block";
            return;
        }
    }

    // Fake login (decoy)
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    if(user && pass) {
        status.textContent = "Login failed! Hint: try modifying your cookie.";
        flagDiv.style.display = "none";
    } else {
        status.textContent = "";
        flagDiv.style.display = "none";
    }
}
</script>

</body>
</html>
